<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="robots" content="noindex, nofollow">
<title>ë“œë˜ê³¤ ë¹„ë²¨/ì´ë²¨ ê³„ì‚°ê¸°</title>
<style>
  body { font-family: Consolas, "Noto Sans KR", sans-serif; margin: 24px; background:#f7f7f9; }
  h2 { margin-bottom: 8px; }
  .hint { color:#666; margin-bottom: 14px; }
  fieldset { background:#fff; border:1px solid #ccc; padding:12px; margin-bottom:14px; }
  legend { font-weight:bold; }
  .row { display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin-bottom:6px; }
  input[type="number"], select { width:84px; text-align:center; }
  .acc-list { max-height:180px; overflow:auto; border:1px solid #ddd; padding:8px; background:#fcfcfc; }
  .btn { padding:8px 14px; cursor:pointer; border:1px solid #999; background:#fff; }
  .btn.primary { border-color:#2d6cdf; background:#2d6cdf; color:#fff; }
  .btn:hover { background:#f0f0f0; }
  .toolbar { display:flex; gap:8px; margin:8px 0; flex-wrap:wrap; }
  #result { white-space:pre; background:#111; color:#e5e5e5; padding:12px; border-radius:6px; min-height:220px; }
  .small { color:#888; font-size:12px; }
  .row-spirit { display: grid; grid-template-columns: 150px 90px 90px 90px auto; align-items: center; column-gap: 8px; margin-bottom: 6px; }
  .row-spirit strong { text-align: right; padding-right: 4px; font-size: 14px; font-weight: bold; }
  .row-spirit input[type="number"] { width: 84px; height: 28px; text-align: center; border: 1px solid #aaa; border-radius: 4px; font-size: 13px; background: #fff; }
  .row-spirit .small { text-align: left; color: #888; font-size: 12px; margin-left: 4px; }
</style>
</head>
<body>
  <h2>ë“œë˜ê³¤ ë¹„ë²¨/ì´ë²¨ ê³„ì‚°ê¸°</h2>
  <div class="hint small">ëª¨ë“  ì…ë ¥ ê°’ì€ HP/ATK/DEF ìˆœì„œë¥¼ ë”°ë¦…ë‹ˆë‹¤. Â· made by í—¬ë¦­ìŠ¤</div>

  <!-- ëª¨ë“œ ì„ íƒ -->
  <fieldset>
    <legend>ëª¨ë“œ ì„ íƒ</legend>
    <label><input type="radio" name="mode" value="auto" checked> ìë™ ê³„ì‚°ê¸°</label>
    <label><input type="radio" name="mode" value="manual"> ìˆ˜ë™ ê³„ì‚°ê¸°</label>
  </fieldset>

  <!-- âœ… ìë™ ê³„ì‚°ê¸° (ê¸°ì¡´ ì „ì²´ êµ¬ì¡°) -->
  <div id="auto_mode">
    <!-- ë“±ê¸‰ / íƒ€ì… -->
    <fieldset>
      <legend>ë“±ê¸‰ / íƒ€ì… ì„ íƒ</legend>
      <div class="row">
        <label><input type="radio" name="level" value="7.0" checked>7.0</label>
        <label><input type="radio" name="level" value="8.0">8.0</label>
        <label><input type="radio" name="level" value="9.0">9.0</label>
      </div>
      <div class="row" style="margin-top:6px">
        <label><input type="checkbox" class="dtype" value="ê³µê²©í˜•" checked>ê³µê²©í˜•</label>
        <label><input type="checkbox" class="dtype" value="ë°©ì–´í˜•" checked>ë°©ì–´í˜•</label>
        <label><input type="checkbox" class="dtype" value="ì²´ë ¥í˜•" checked>ì²´ë ¥í˜•</label>
        <label><input type="checkbox" class="dtype" value="ê³µë°©í˜•" checked>ê³µë°©í˜•</label>
        <label><input type="checkbox" class="dtype" value="ì²´ê³µí˜•" checked>ì²´ê³µí˜•</label>
        <label><input type="checkbox" class="dtype" value="ì²´ë°©í˜•" checked>ì²´ë°©í˜•</label>
      </div>
    </fieldset>

    <!-- ì ¬ ì„ íƒ -->
    <fieldset>
      <legend>ì ¬ ì„ íƒ (â€» ë³µìˆ˜ ì„ íƒ ë¶ˆê°€)</legend>
      <div class="row">
        <strong>HP</strong>
        <label><input type="radio" name="gem_hp" value="160">160</label>
        <label><input type="radio" name="gem_hp" value="156" checked>156</label>
        <label><input type="radio" name="gem_hp" value="152">152</label>
        <label><input type="radio" name="gem_hp" value="148">148</label>
      </div>
      <div class="row">
        <strong>ATK</strong>
        <label><input type="radio" name="gem_atk" value="40">40</label>
        <label><input type="radio" name="gem_atk" value="39" checked>39</label>
        <label><input type="radio" name="gem_atk" value="38">38</label>
        <label><input type="radio" name="gem_atk" value="37">37</label>
      </div>
      <div class="row">
        <strong>DEF</strong>
        <label><input type="radio" name="gem_df" value="40">40</label>
        <label><input type="radio" name="gem_df" value="39" checked>39</label>
        <label><input type="radio" name="gem_df" value="38">38</label>
        <label><input type="radio" name="gem_df" value="37">37</label>
      </div>
    </fieldset>

    <!-- ì¥ì‹ êµ¬ -->
    <fieldset>
      <legend>ì¥ì‹ êµ¬ ì„ íƒ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</legend>
      <div class="toolbar">
        <button class="btn" type="button" onclick="toggleLevel(19)">Lv19 ì „ì²´ ì„ íƒ</button>
        <button class="btn" type="button" onclick="toggleLevel(18)">Lv18 ì „ì²´ ì„ íƒ</button>
        <button class="btn" type="button" onclick="toggleLevel(17)">Lv17 ì „ì²´ ì„ íƒ</button>
        <button class="btn" type="button" onclick="selectNone()">ì „ì²´ í•´ì œ</button>
      </div>
      <div id="accList" class="acc-list"></div>
    </fieldset>

    <!-- íœë˜íŠ¸ -->
    <fieldset>
      <legend>íœë˜íŠ¸</legend>
      <div class="row" style="margin-bottom:8px;">
        <strong>ë²„ì „ ì„ íƒ:</strong>
        <label><input type="radio" name="pendant_ver" value="v1" checked>Ver1</label>
        <label><input type="radio" name="pendant_ver" value="v2">Ver2</label>
        <label><input type="radio" name="pendant_ver" value="v3">Ver3</label>
      </div>
      <div class="row" id="pendant_auto_row">
        <strong>ì¢…ë¥˜ / ê°’ ì…ë ¥:</strong>
        <label><input type="radio" name="pendant_mode" value="ë³„" checked>ë³„</label>
        <label><input type="radio" name="pendant_mode" value="ë‹¬">ë‹¬</label>
        <label><input type="radio" name="pendant_mode" value="íƒœì–‘">íƒœì–‘</label>
        <input id="pendant_value" type="number" value="12" style="width:90px;"> %
      </div>
      <div class="row" id="pendant_stats_row" style="display:none;">
        <strong>Ver2 ìŠ¤íƒ¯ ì„ íƒ:</strong>
        <label><input type="checkbox" class="pendStat" value="HP" checked>HP</label>
        <label><input type="checkbox" class="pendStat" value="ATK" checked>ATK</label>
        <label><input type="checkbox" class="pendStat" value="DEF" checked>DEF</label>
      </div>
      <div id="pendant_manual" style="margin-top:8px; display:none;">
        <strong>ìˆ˜ë™ ì…ë ¥:</strong>
        HP <input id="pend_manual_hp" type="number" value="0">%
        ATK <input id="pend_manual_atk" type="number" value="0">%
        DEF <input id="pend_manual_df" type="number" value="0">%
      </div>
    </fieldset>

    <!-- ì •ë ¹ / ë²„í”„ / ë””ë²„í”„ -->
    <fieldset>
      <legend>ì •ë ¹ / ë²„í”„ / ë””ë²„í”„</legend>
      <div class="row-spirit"><strong>ì •ë ¹ + (í”Œì˜µ)</strong><input id="sf_hp" type="number" value="0"><input id="sf_atk" type="number" value="0"><input id="sf_df" type="number" value="0"></div>
      <div class="row-spirit"><strong>ì •ë ¹ % (í¼ì˜µ)</strong><input id="sp_hp" type="number" value="0"><input id="sp_atk" type="number" value="0"><input id="sp_df" type="number" value="0"></div>
      <div class="row-spirit"><strong>ë²„í”„ (%)</strong><input id="bf_hp" type="number" value="0"><input id="bf_atk" type="number" value="0"><input id="bf_df" type="number" value="0"></div>
      <div class="row-spirit"><strong>ë””ë²„í”„ (%)</strong><input id="db_hp" type="number" value="0"><input id="db_atk" type="number" value="0"><input id="db_df" type="number" value="0"></div>
    </fieldset>

    <fieldset><legend>ê¸°íƒ€</legend><div class="row">Top N <input id="top_n" type="number" value="5"></div></fieldset>
    <div class="toolbar">
      <button class="btn primary" type="button" onclick="calc()">ê³„ì‚°í•˜ê¸°</button>
      <button class="btn" type="button" onclick="downloadTxt()">ì €ì¥í•˜ê¸° (.txt)</button>
    </div>
  </div>

  <!-- âœ… ìˆ˜ë™ ê³„ì‚°ê¸° -->
  <div id="manual_mode" style="display:none;">
    <fieldset>
      <legend>ìˆ˜ë™ ê³„ì‚°ê¸°</legend>
      <div class="row">
        <label>ë“±ê¸‰:
          <select id="m_level">
            <option value="7.0">7.0</option><option value="8.0">8.0</option><option value="9.0">9.0</option>
          </select>
        </label>
        <label>íƒ€ì…:
          <select id="m_type">
            <option>ê³µê²©í˜•</option><option>ë°©ì–´í˜•</option><option>ì²´ë ¥í˜•</option>
            <option>ê³µë°©í˜•</option><option>ì²´ê³µí˜•</option><option>ì²´ë°©í˜•</option>
          </select>
        </label>
      </div>
    </fieldset>
    <fieldset>
      <legend>ì ¬ ìŠ¬ë¡¯ (5ê°œ)</legend><div id="gem_slots"></div>
    </fieldset>
    <fieldset>
      <legend>ì¥ì‹ êµ¬ / ì¸ì²¸íŠ¸ (%)</legend>
      <div class="row">ì¥ì‹ êµ¬ HP <input id="m_acc_hp" type="number" value="0"> ATK <input id="m_acc_atk" type="number" value="0"> DEF <input id="m_acc_df" type="number" value="0"></div>
      <div class="row">ì¸ì²¸íŠ¸ HP <input id="m_ench_hp" type="number" value="0"> ATK <input id="m_ench_atk" type="number" value="0"> DEF <input id="m_ench_df" type="number" value="0"></div>
    </fieldset>
    <fieldset>
      <legend>íœë˜íŠ¸ ì…ë ¥ (%)</legend>
      <div class="row">HP <input id="m_pend_hp" type="number" value="0"> ATK <input id="m_pend_atk" type="number" value="0"> DEF <input id="m_pend_df" type="number" value="0"></div>
    </fieldset>
    <div class="toolbar"><button class="btn primary" onclick="manualCalc()">ìˆ˜ë™ ê³„ì‚°</button></div>
  </div>

  <h3>ê²°ê³¼</h3>
  <div id="result"></div>

<script>
/* =========================
   ê³µí†µ ê³„ì‚° ë¡œì§
   ========================= */
class Stats{constructor(hp,atk,df){this.hp=hp;this.atk=atk;this.df=df;}}
function eVal(s){return s.hp+4*s.atk+4*s.df;}
function bVal(s){return s.hp*s.atk*s.df;}
function calcPredict(base,gem,pot,acc,pend,spf,spp,spe,col,bf,db){
  const s1=new Stats(base.hp+gem.hp+pot.hp, base.atk+gem.atk+pot.atk, base.df+gem.df+pot.df);
  const s2=new Stats(Math.floor(s1.hp*(1+acc.hp)), Math.floor(s1.atk*(1+acc.atk)), Math.floor(s1.df*(1+acc.df)));
  const s3=new Stats(Math.floor(s2.hp*(1+spp.hp)+spf.hp*(1+spp.hp)),
                     Math.floor(s2.atk*(1+spp.atk)+spf.atk*(1+spp.atk)),
                     Math.floor(s2.df*(1+spp.df)+spf.df*(1+spp.df)));
  const s4=new Stats(s3.hp+spe.hp, s3.atk+spe.atk, s3.df+spe.df);
  const s5=new Stats(Math.floor(s4.hp*(1+pend.hp)), Math.floor(s4.atk*(1+pend.atk)), Math.floor(s4.df*(1+pend.df)));
  const s6=new Stats(s5.hp+col.hp, s5.atk+col.atk, s5.df+col.df);
  const f = new Stats(
    s6.hp + Math.floor(base.hp*bf.hp) - Math.floor(base.hp*db.hp),
    s6.atk + Math.floor(base.atk*bf.atk) - Math.floor(base.atk*db.atk),
    s6.df + Math.floor(base.df*bf.df) - Math.floor(base.df*db.df)
  );
  return [f,eVal(f),bVal(f)];
}

/* =========================
   ê¸°ë³¸ ìŠ¤íƒ¯
   ========================= */
const dragon={
 "7.0":{ê³µê²©í˜•:new Stats(876,285,161),ë°©ì–´í˜•:new Stats(788,185,283),ì²´ë ¥í˜•:new Stats(1252,176,176),ê³µë°©í˜•:new Stats(720,242,243),ì²´ê³µí˜•:new Stats(1080,262,133),ì²´ë°©í˜•:new Stats(1080,133,262)},
 "8.0":{ê³µê²©í˜•:new Stats(876,305,161),ë°©ì–´í˜•:new Stats(788,185,303),ì²´ë ¥í˜•:new Stats(1332,176,176),ê³µë°©í˜•:new Stats(720,252,253),ì²´ê³µí˜•:new Stats(1120,272,133),ì²´ë°©í˜•:new Stats(1120,133,272)},
 "9.0":{ê³µê²©í˜•:new Stats(876,325,161),ë°©ì–´í˜•:new Stats(788,185,323),ì²´ë ¥í˜•:new Stats(1412,176,176),ê³µë°©í˜•:new Stats(720,262,263),ì²´ê³µí˜•:new Stats(1160,282,133),ì²´ë°©í˜•:new Stats(1160,133,282)}
};

/* =========================
   ì ¬ ìŠ¬ë¡¯ ë Œë”ë§
   ========================= */
const gemOptions={HP:[160,156,152,148],ATK:[40,39,38,37],DEF:[40,39,38,37]};
function renderGems(){
  const c=document.getElementById('gem_slots');c.innerHTML='';
  for(let i=1;i<=5;i++){
    const row=document.createElement('div');
    row.className='row';
    row.innerHTML=`ìŠ¬ë¡¯${i} <select id="slot_type_${i}">
      <option value="">--ì„ íƒ--</option><option value="HP">HP</option><option value="ATK">ATK</option><option value="DEF">DEF</option></select>
      <select id="slot_val_${i}"><option value="0">--ê°’ ì„ íƒ--</option></select>`;
    c.appendChild(row);
    const type=row.querySelector(`#slot_type_${i}`),val=row.querySelector(`#slot_val_${i}`);
    type.addEventListener('change',()=>{val.innerHTML='<option value="0">--ê°’ ì„ íƒ--</option>';const t=type.value;if(t&&gemOptions[t])gemOptions[t].forEach(v=>val.innerHTML+=`<option value="${v}">${v}</option>`);});
  }
}
renderGems();

/* =========================
   ëª¨ë“œ ì „í™˜
   ========================= */
document.querySelectorAll('input[name="mode"]').forEach(r=>{
  r.addEventListener('change',()=>{
    const m=document.querySelector('input[name="mode"]:checked').value;
    document.getElementById('auto_mode').style.display=(m==='auto')?'block':'none';
    document.getElementById('manual_mode').style.display=(m==='manual')?'block':'none';
  });
});

/* =========================
   ìˆ˜ë™ ê³„ì‚°
   ========================= */
function manualCalc(){
  const lvl = document.getElementById('m_level').value;
  const type = document.getElementById('m_type').value;
  const base = dragon[lvl][type];

  // ì ¬ í•©ì‚°
  let g_hp = 0, g_atk = 0, g_df = 0;
  for (let i = 1; i <= 5; i++) {
    const t = document.getElementById(`slot_type_${i}`).value;
    const v = Number(document.getElementById(`slot_val_${i}`).value || 0);
    if (t === "HP") g_hp += v;
    if (t === "ATK") g_atk += v;
    if (t === "DEF") g_df += v;
  }
  const gem = new Stats(g_hp, g_atk, g_df);

  // ì¥ì‹ êµ¬ + ì¸ì²¸íŠ¸ (%)
  const acc = new Stats(
    (Number(document.getElementById("m_acc_hp").value) + Number(document.getElementById("m_ench_hp").value)) / 100,
    (Number(document.getElementById("m_acc_atk").value) + Number(document.getElementById("m_ench_atk").value)) / 100,
    (Number(document.getElementById("m_acc_df").value) + Number(document.getElementById("m_ench_df").value)) / 100
  );

  // íœë˜íŠ¸ (%)
  const pend = new Stats(
    Number(document.getElementById("m_pend_hp").value) / 100,
    Number(document.getElementById("m_pend_atk").value) / 100,
    Number(document.getElementById("m_pend_df").value) / 100
  );

  // ê¸°ë³¸ ìƒìˆ˜
  const pot = new Stats(24, 6, 6);
  const col = new Stats(240, 60, 60);

  // ì •ë ¹ / ë²„í”„ / ë””ë²„í”„ ê°’ (ìë™ëª¨ë“œ UI ê°’ ê·¸ëŒ€ë¡œ í™œìš©)
  const val = id => Number(document.getElementById(id)?.value || 0);
  const spf = new Stats(val('sf_hp'), val('sf_atk'), val('sf_df'));
  const spp = new Stats(val('sp_hp') / 100, val('sp_atk') / 100, val('sp_df') / 100);
  const spe = new Stats(0, 0, 0);
  const bf  = new Stats(val('bf_hp') / 100, val('bf_atk') / 100, val('bf_df') / 100);
  const db  = new Stats(val('db_hp') / 100, val('db_atk') / 100, val('db_df') / 100);

  // ê³„ì‚°
  const [fin, E, B] = calcPredict(base, gem, pot, acc, pend, spf, spp, spe, col, bf, db);

  // ì¶œë ¥
  const R = document.getElementById("result");
  R.textContent = `ğŸ’ ìˆ˜ë™ ê³„ì‚° ê²°ê³¼\n\n` +
                  `ë“œë˜ê³¤: ${lvl} ${type}\n` +
                  `HP=${fin.hp}\nATK=${fin.atk}\nDEF=${fin.df}\n` +
                  `E=${E.toFixed(0)}\nB=${(B / 1e6).toFixed(3)}`;
}

/* =========================
   ìë™ ê³„ì‚°ìš© ì¥ì‹ êµ¬ í…Œì´ë¸”
   ========================= */
const ACC_TABLE = [
  ["ë°”ë¿”(ê³µ/ë°©)",19,0,10,9],["ë°”ë¿”(ì²´/ë°©)",19,10,0,9],["ë°”ë¿”(ê³µ/ì²´)",19,9,10,0],
  ["ë¶ˆë¿”(ê³µ/ì²´)",19,6,13,0],["ë¶ˆë¿”(ê³µ/ë°©)",19,0,13,6],
  ["ë¬¼ë¿”(ì²´/ë°©)",19,13,0,6],["ë¬¼ë¿”(ì²´/ê³µ)",19,13,6,0],
  ["ëŒ€ë¿”(ë°©/ê³µ)",19,0,6,13],["ëŒ€ë¿”(ë°©/ì²´)",19,6,0,13],
  ["ì—¬ë³´",19,0,0,19],["í™©ë³´",19,0,19,0],["ì•…ë³´",19,19,0,0],
  ["ë°”ë¿”(ê³µ/ë°©)",18,0,9,9],["ë°”ë¿”(ì²´/ë°©)",18,9,0,9],["ë°”ë¿”(ê³µ/ì²´)",18,9,9,0],
  ["ë¶ˆë¿”(ê³µ/ì²´)",18,6,12,0],["ë¶ˆë¿”(ê³µ/ë°©)",18,0,12,6],
  ["ë¬¼ë¿”(ì²´/ë°©)",18,12,0,6],["ë¬¼ë¿”(ì²´/ê³µ)",18,12,6,0],
  ["ëŒ€ë¿”(ë°©/ê³µ)",18,0,6,12],["ëŒ€ë¿”(ë°©/ì²´)",18,6,0,12],
  ["ì—¬ë³´",18,0,0,18],["í™©ë³´",18,0,18,0],["ì•…ë³´",18,18,0,0],
  ["ë°”ë¿”(ê³µ/ë°©)",17,0,9,8],["ë°”ë¿”(ì²´/ë°©)",17,9,0,8],["ë°”ë¿”(ê³µ/ì²´)",17,9,8,0],
  ["ë¶ˆë¿”(ê³µ/ì²´)",17,6,11,0],["ë¶ˆë¿”(ê³µ/ë°©)",17,0,11,6],
  ["ë¬¼ë¿”(ì²´/ë°©)",17,11,0,6],["ë¬¼ë¿”(ì²´/ê³µ)",17,11,6,0],
  ["ëŒ€ë¿”(ë°©/ê³µ)",17,0,6,11],["ëŒ€ë¿”(ë°©/ì²´)",17,6,0,11],
  ["ì—¬ë³´",17,0,0,17],["í™©ë³´",17,0,17,0],["ì•…ë³´",17,17,0,0],
];

/* =========================
   ì¥ì‹ êµ¬ ë Œë”ë§ (ìë™ëª¨ë“œ)
   ========================= */
let accCheckboxes = [];
const accListEl = document.getElementById('accList');
function renderAccessories() {
  if (!accListEl) return;
  accListEl.innerHTML = '';
  accCheckboxes = [];
  ACC_TABLE.forEach((r, i) => {
    const [n, l, h, a, d] = r;
    const id = 'acc_' + i;
    const line = document.createElement('div');
    line.innerHTML = `<label><input type="checkbox" id="${id}"> ${n} Lv${l} | HP+${h}% ATK+${a}% DEF+${d}%</label>`;
    accListEl.appendChild(line);
    accCheckboxes.push({ id, name: n, level: l, hp: h, atk: a, df: d });
  });
}
renderAccessories();

function selectNone() { accCheckboxes.forEach(o => document.getElementById(o.id).checked = false); }
function toggleLevel(level) {
  const t = accCheckboxes.filter(o => o.level === level);
  const allOn = t.every(o => document.getElementById(o.id).checked);
  t.forEach(o => document.getElementById(o.id).checked = !allOn);
}

/* =========================
   ì €ì¥ ê¸°ëŠ¥ (ê³µí†µ)
   ========================= */
function downloadTxt(){
  const text=document.getElementById("result").textContent||"";
  if(!text.trim()) return;
  const blob=new Blob([text],{type:"text/plain;charset=utf-8"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url; a.download="dragon_result.txt";
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
